
# Product Requirements

1.  **Общие сведения**

-   Описание проекта
-   Цель и задачи приложения
-   Требования к технологии и окружению (Java, библиотека Lanterna, Telegram API)

3.  **Архитектура приложения**

-   Общая структура и основные модули
-   Взаимодействие с API Telegram
-   Особенности работы с псевдографикой

5.  **Интерфейс пользователя**

-   Общие принципы интерфейса и UX-ориентиры
-   Описание основных экранов

-   Экран входа и аутентификации
-   Основной экран (со списком чатов)
-   Экран чата
-   Экран профиля пользователя и настроек

7.  **Взаимодействие с API Telegram**

-   Получение и отправка сообщений
-   Управление чатами и пользователями
-   Управление медиафайлами и вложениями

9.  **Работа с данными и хранение**

-   Хранение кэша сообщений и данных о пользователе
-   Локальное кэширование (опционально)

11.  **Логика и обработка событий**

-   Поток входящих и исходящих сообщений
-   Обработка команд и горячих клавиш
-   Реализация основных действий (навигация, отправка сообщений и т.д.)

13.  **Тестирование и отладка**

-   Сценарии тестирования
-   Отладочные режимы и инструменты

15.  **Требования к безопасности**

-   Шифрование и хранение данных
-   Защита от несанкционированного доступа

17.  **Дополнительно**

-   Расширения и возможные улучшения

### 1. Общие сведения

#### 1.1 Описание проекта

Проект представляет собой текстовое клиентское приложение Telegram с псевдографическим интерфейсом, подобным Norton Commander. Приложение предназначено для работы с основными функциями мессенджера Telegram в формате консольного интерфейса. Оно будет поддерживать взаимодействие с чатом, обмен текстовыми сообщениями и базовые операции с медиафайлами.

#### 1.2 Цель и задачи приложения

Основная цель разработки — создать легковесный клиент Telegram с функционалом для отправки и получения сообщений, управления чатами, просмотра профилей и других базовых действий. Приложение должно быть удобным для пользователей, предпочитающих консольный интерфейс, и обладать минимальными системными требованиями.

Задачи:

-   Обеспечить простой и интуитивный консольный интерфейс для работы с основными функциями Telegram.
-   Реализовать основные возможности мессенджера, включая отправку и получение сообщений, доступ к контактам и группам, работу с медиа.
-   Создать псевдографический интерфейс, удобный для навигации по чатам и сообщениям с помощью клавиатуры.

#### 1.3 Требования к технологии и окружению

**Технологии и библиотеки**:

-   Язык программирования: Java.
-   Библиотека для консольного интерфейса: `com.googlecode.lanterna`.
-   API Telegram: MTProto (Telegram API для  клиентов).

**Окружение и зависимости**:

-   Java SE 11 или выше.
-   Интернет-соединение для работы с Telegram API.
-   API ID и API Hash, которые необходимо получить через Telegram Developer Console.

**Целевые платформы**:

-   Поддержка операционных систем: Windows, Linux, MacOS.

### 2. Архитектура приложения

#### 2.1 Общая структура и основные модули

Приложение будет состоять из следующих модулей:

-   **Главный модуль (Main)**: точка входа в приложение, отвечает за инициализацию интерфейса и установку соединения с Telegram API.
-   **Модуль интерфейса пользователя (UI Module)**: реализует графический интерфейс в псевдографике, использует библиотеку `com.googlecode.lanterna`. Основные компоненты:

-   _Экран входа и аутентификации_
-   _Главный экран со списком чатов_
-   _Экран чата_
-   _Экран профиля и настроек пользователя_

-   **Модуль работы с Telegram API (Telegram API Module)**: взаимодействует с Telegram API, обрабатывает отправку и получение данных (сообщений, пользователей, чатов). Этот модуль реализует основные функции API и обрабатывает сессии MTProto.
-   **Модуль логики и обработки событий (Logic & Event Handling Module)**: управляет логикой интерфейса и пользовательскими событиями, такими как навигация, ввод текста, команды горячих клавиш и взаимодействие между модулями.
-   **Модуль хранения данных (Data Storage Module)**: управляет локальным кэшированием данных пользователя и сообщений (опционально). Также обеспечивает хранение информации о состоянии приложения (например, последний активный чат).

#### 2.2 Взаимодействие с API Telegram

Приложение использует клиентский API Telegram (MTProto) для взаимодействия с Telegram-серверами. Взаимодействие организовано следующим образом:

1.  **Авторизация и аутентификация пользователя**: модуль Telegram API обеспечивает аутентификацию через MTProto, запрашивая у пользователя телефонный номер и отправляя ему код для верификации.
2.  **Управление чатами**: включает доступ к списку чатов, загрузку истории сообщений, создание и настройку чатов.
3.  **Отправка и получение сообщений**: обработка входящих и исходящих сообщений, поддержка обновлений чатов и уведомлений.
4.  **Работа с медиа и файлами**: загрузка, отображение, отправка и загрузка изображений и файлов (ограниченная поддержка для псевдографического интерфейса).

#### 2.3 Особенности работы с псевдографикой

Интерфейс приложения будет построен с использованием текстовой графики, предлагая пользователю привычную консольную навигацию.

**Основные элементы интерфейса**:

-   **Окна и панели**: каждое окно будет представлено отдельным интерфейсным элементом (например, окна для чатов, меню профиля и настроек).
-   **Навигация**: клавиши навигации (стрелки, Enter, Esc) для перемещения по чатам, перехода в меню, управления настройками и отправки сообщений.
-   **Цветовые схемы и форматирование текста**: интерфейс будет использовать выделение цветом и символами для различия сообщений, подсветки активных элементов, отображения новых сообщений и уведомлений.

#### 2.4 Потоки и обработка данных

Для работы с обновлениями от Telegram и внутренней логики приложения будут использоваться отдельные потоки. Основные потоки:

-   **Главный поток UI**: отвечает за рендеринг и обработку пользовательских взаимодействий.
-   **Фоновый поток для Telegram API**: обрабатывает отправку/получение данных и асинхронные запросы к API.

### 3. Интерфейс пользователя

#### 3.1 Общие принципы интерфейса и UX-ориентиры

Интерфейс приложения будет выполнен в стиле псевдографики, предоставляя пользователю интуитивное текстовое представление чатов, сообщений и элементов управления. Для навигации будут использоваться клавиши стрелок, а также комбинации клавиш для доступа к основным функциям (например, отправка сообщений, выход, переключение между чатами). Основной упор делается на удобство, минимализм и быстрое освоение пользователем.

**Основные элементы интерфейса**:

-   Панель для отображения списка чатов.
-   Область для просмотра и отправки сообщений.
-   Панель статуса для отображения текущего чата, статуса подключения и других сведений.

#### 3.2 Описание основных экранов

**Экран входа и аутентификации**

-   Появляется при запуске приложения.
-   Запрашивает у пользователя телефонный номер и отображает поле для ввода кода подтверждения (получаемого по SMS).
-   После успешного входа перенаправляет пользователя на основной экран.

**Основной экран (со списком чатов)**

-   Содержит список всех доступных чатов (личных, групповых и каналов).
-   Отображает активные чаты с указанием количества непрочитанных сообщений.
-   Обозначение новых сообщений (выделение цветом или символами).
-   Навигация по списку — стрелки вверх/вниз. Для выбора чата — Enter.

**Экран чата**

-   Отображает историю сообщений выбранного чата.
-   В верхней части экрана указывается название чата и текущий статус пользователя (в сети/не в сети).
-   В нижней части — поле для ввода сообщения.
-   Клавиша Enter отправляет сообщение, клавиша Esc возвращает на главный экран.
-   Возможность просмотра вложений и медиа, доступных для отображения в текстовом формате.

**Экран профиля пользователя и настроек**

-   Отображает основные сведения о текущем пользователе: имя, телефон, статус.
-   Настройки, доступные в текстовом формате: уведомления, автообновления и кэш сообщений.
-   Возможность выйти из аккаунта и завершить текущую сессию.

#### 3.3 Горячие клавиши и команды

Система горячих клавиш и команд позволит пользователю быстро ориентироваться по приложению. Основные клавиши:

-   **Навигация**:

-   Стрелки вверх/вниз — прокрутка по спискам.
-   Enter — выбор текущего элемента (например, открытие чата).
-   Esc — возврат на предыдущий экран.

-   **Управление**:

-   `Ctrl+N` — создать новый чат.
-   `Ctrl+Q` — выйти из приложения.
-   `Ctrl+S` — перейти в настройки.`
-   `Ctrl+C` выделенный текст копируется в буфер обмена.

-   **Мышь**:

-   **Навигация по чатам**: пользователь может кликнуть на чат в списке для его открытия.
-   **Выделение текста**: кликом и перетаскиванием можно выделять текст сообщения. Выделенный текст будет доступен для копирования.

#### 3.4 Цветовая схема и форматирование

-   **Активные элементы**: выделяются цветом или символами, чтобы пользователь мог легко идентифицировать текущий выбор.
-   **Непрочитанные сообщения**: отображаются с другим фоном или шрифтом.
-   **Сообщения пользователя и собеседника**: различаются по выравниванию и цвету для удобства чтения.

### 4. Взаимодействие с API Telegram

#### 4.1 Аутентификация и авторизация

Приложение будет использовать клиентский API Telegram (MTProto) для авторизации пользователя. Для работы с API необходимы `API ID` и `API Hash`, которые нужно получить на Telegram Developer Console.

**Этапы аутентификации**:

1.  **Запрос телефонного номера**: приложение запрашивает у пользователя его номер телефона.
2.  **Подтверждение через код**: после запроса телефонного номера пользователь вводит код, отправленный по SMS.
3.  **Создание и хранение сессии**: после успешной аутентификации сессия сохраняется локально, чтобы при следующем запуске пользователь не должен был проходить повторную авторизацию (по необходимости).

#### 4.2 Основные функции взаимодействия с Telegram API

Приложение должно обеспечить основные функции обмена сообщениями, управления чатами и работы с медиа. Эти функции обрабатываются с помощью MTProto-сессий.

**Функции и их описание**:

-   **Загрузка списка чатов**: при запуске приложение загружает список доступных чатов и отображает его на основном экране.
-   **Получение и отправка сообщений**:

-   Запрос истории сообщений при открытии чата.
-   Отправка текстовых сообщений и отправка уведомления о новых сообщениях собеседнику.

-   **Получение уведомлений о новых сообщениях**: приложение обрабатывает обновления от Telegram для уведомления пользователя о новых сообщениях в режиме реального времени.

#### 4.3 Управление чатами и пользователями

**Функционал управления чатами**:

-   Создание новых чатов (поиск контактов для добавления).
-   Переход в конкретный чат (выбор в списке с помощью клавиш или мыши).
-   Поддержка как личных, так и групповых чатов.

**Работа с пользователями**:

-   Загрузка данных профиля собеседников при открытии чата.
-   Отображение статуса пользователя (например, "онлайн" или "был в сети").

#### 4.4 Работа с медиафайлами и вложениями

Поскольку приложение будет текстовым, функционал работы с медиафайлами будет ограничен:

-   Attachment files, аудио, видео следует по возможности сохранять в системную директорию пользователя Downloads (в зависимости от ОС).
-   Картинки, стикеры, смайлики отображать в виде их текстовых представлений, ссылок или идетификаторов.

#### 4.5 Обработка и кэширование данных

Чтобы улучшить производительность и уменьшить количество обращений к API, кэшируются данные, такие как список чатов, история сообщений и статусы пользователей.

#### 4.6 Обработка уведомлений о новых сообщениях

**Принцип работы уведомлений**:

-   **Фоновый поток для получения обновлений**: приложение создаёт фоновый поток, который периодически запрашивает сервер Telegram на наличие новых сообщений (используя API MTProto). Этот поток будет асинхронно обрабатывать обновления.
-   **Обновление индикаторов**:

-   **Список чатов**: при появлении нового сообщения в чате рядом с названием чата отображается индикатор (например, звёздочка или счётчик непрочитанных сообщений).
-   **Цветовая подсветка**: чат с новыми сообщениями можно выделять другим цветом или фоном.

-   **Активный чат**: если новое сообщение пришло в текущем активном чате, оно автоматически отображается в окне сообщений с меткой времени, чтобы пользователь видел его сразу.

**Алгоритм обработки уведомлений**:

1.  **Запрос обновлений**: фоновый поток отправляет периодический запрос к API для проверки новых сообщений.
2.  **Определение чатов с новыми сообщениями**: приложение обновляет состояние списка чатов, добавляя индикаторы к тем, где есть непрочитанные сообщения.
3.  **Обновление экрана**: интерфейс обновляется, чтобы пользователь видел новые индикаторы или выделение.

Этот подход минимизирует нагрузки и позволяет держать пользователя в курсе о новых сообщениях без излишнего перегружения интерфейса.

### 5. Работа с данными и хранение

#### 5.1 Хранение кэша сообщений и данных о пользователе

Для обеспечения функциональности приложения и уменьшения количества запросов к API Telegram предусмотрено кэширование данных с обязательным хранением между сессиями в файлах. Это позволит пользователю получать доступ к информации даже после закрытия приложения.

**Кэшируемые данные**:

-   **Список чатов**: сохраняется локально для быстрого доступа при запуске приложения и навигации по чатам.
-   **История сообщений**: при открытии чата загружается и кэшируется история сообщений, чтобы избежать повторных запросов при повторном входе.
-   **Данные профиля**: информация о пользователе и собеседниках (имя, фото, статус) кэшируется для быстрого отображения.

**Формат хранения**:

-   Данные будут храниться в виде JSON-файлов. Каждый тип данных будет иметь свой собственный файл (например, `chats.json`, `messages.json`, `user_data.json`).

#### 5.2 Локальное кэширование и безопасность

Для защиты данных от несанкционированного доступа, все файлы должны быть зашифрованы перед сохранением на диск.

**Методы безопасности**:

-   **Шифрование**: при сохранении данных в файл использовать симметричное шифрование (например, AES). Это обеспечит, что только приложение, имеющее ключ шифрования, сможет расшифровать и прочитать данные.
-   **Хранение ключа**: ключ шифрования может храниться в конфигурационном файле, который не будет доступен для чтения другим пользователям (например, использовать доступ по правам).

**Пример структуры данных**:

-   **Список чатов**:

java

Копировать код

```
Map<String, Chat> chatCache; 
```

-   **История сообщений**:

java

Копировать код

```
Map<String, List<Message>> messageHistoryCache; 
```

#### 5.3 Обработка данных

Обработка данных включает в себя:

-   **Загрузка данных из кэша**: при запуске приложение сначала проверяет, существуют ли файлы с кэшированными данными, и если да, загружает их, расшифровывая.
-   **Синхронизация с API**: если кэш пуст или устарел, приложение делает запрос к API для получения актуальных данных.
-   **Обновление кэша**: после получения новых данных и их шифрования обновляется кэш и сохраняется в соответствующие файлы.

### 6. Тестирование и отладка

#### 6.1 Стратегия тестирования

Тестирование приложения будет проводиться на нескольких уровнях, включая юнит-тесты, интеграционные тесты и функциональные тесты, чтобы гарантировать стабильность и работоспособность всех компонентов.

**Уровни тестирования**:

-   **Юнит-тестирование**: тестирование отдельных модулей и функций, таких как обработка сообщений, работа с API и функции пользовательского интерфейса.
-   **Интеграционное тестирование**: проверка взаимодействия между модулями, включая взаимодействие с API Telegram, а также корректность обработки данных и кэширования.
-   **Функциональное тестирование**: тестирование всего приложения с точки зрения пользователя, включая сценарии использования, навигацию и отправку/получение сообщений.

#### 6.2 Инструменты для тестирования

Для реализации тестирования могут использоваться следующие инструменты и библиотеки:

-   **JUnit**: для написания и выполнения юнит-тестов.
-   **Mockito**: для создания мок-объектов и тестирования взаимодействия между компонентами.
-   **TestNG**: для реализации интеграционных тестов и упрощения процессов тестирования.
-   **JavaFX** (или аналогичные библиотеки): для тестирования интерфейса пользователя.

#### 6.3 Методология отладки

Отладка приложения будет основываться на логировании и мониторинге производительности:

-   **Логирование**: приложение будет использовать логгирование для отслеживания ошибок и событий. Логи будут храниться в текстовых файлах, чтобы разработчики могли проанализировать их при возникновении проблем.
-   **Мониторинг состояния**: создание механизма мониторинга для отслеживания состояния подключения к API, активности пользователя и получения новых сообщений.

**Рекомендуемые методы отладки**:

-   Использование встроенных средств отладки в IDE (например, IntelliJ IDEA) для проверки значений переменных и состояния потоков.
-   Пошаговая отладка, чтобы анализировать проблемы в реальном времени и выявлять ошибки на этапе разработки.

#### 6.4 Тестовые сценарии

Тестирование будет основываться на наборе заранее определённых сценариев, включая:

-   Аутентификация и авторизация пользователя.
-   Отправка и получение сообщений между пользователями.
-   Проверка работы уведомлений о новых сообщениях.
-   Тестирование навигации по интерфейсу (как клавишами, так и мышкой).
-   Проверка работы с кэшированием и безопасностью данных.

### 7. Документация и поддержка

#### 7.1 Документация для разработчиков

Полная документация должна быть создана для поддержки разработчиков в процессе создания и поддержки приложения. Документация будет включать в себя:

-   **Общее руководство**: описание приложения, его функций и архитектуры.
-   **API документация**: детальное описание всех методов, используемых для взаимодействия с API Telegram, включая примеры вызовов и ответов.
-   **Структура данных**: описание всех используемых классов и их методов, а также формат хранения данных.
-   **Инструкции по установке**: шаги для установки необходимых библиотек, инструментов и конфигурации среды разработки.
-   **Гайды по тестированию**: рекомендации по выполнению тестов, включая примеры тестовых сценариев и методов их выполнения.

#### 7.2 Пользовательская документация

Для конечных пользователей приложения необходимо создать инструкцию по использованию, включающую:

-   **Руководство по началу работы**: шаги для установки и настройки приложения.
-   **Описание функций**: пояснения к основным функциям приложения, включая управление чатами, отправку и получение сообщений.
-   **Часто задаваемые вопросы (FAQ)**: ответы на распространённые вопросы и проблемы, которые могут возникнуть у пользователей.

Документацию вести в файле README.md  в корне проекта

### 8. Заключение

#### 8.1 Итоговая цель проекта

Создание клиентского приложения Telegram в виде псевдографики с использованием Java и библиотеки com.googlecode.lanterna направлено на обеспечение удобного и интуитивно понятного интерфейса для пользователей, которые предпочитают текстовые интерфейсы и легковесные решения. Это приложение должно предложить полный набор функций, включая обмен сообщениями, навигацию по чатам и работу с данными, при этом обеспечивая безопасность и защиту пользовательской информации.

#### 8.2 Ожидаемые результаты

Ожидается, что успешная реализация данного проекта приведёт к:

-   Высокой степени удовлетворенности пользователей благодаря простоте и доступности интерфейса.
-   Минимизации нагрузки на серверы Telegram за счёт эффективного кэширования и обработки данных.
-   Обеспечению безопасности пользовательских данных, что станет важным аспектом для защиты конфиденциальности.

#### 8.3 Перспективы развития

В будущем приложение может быть расширено дополнительными функциями, такими как:

-   Поддержка голосовых сообщений и медиафайлов.
-   Интеграция с другими сервисами (например, для обмена файлами или работы с календарями).
-   Расширенные возможности настройки интерфейса и функционала для пользователей.

#### 8.4 Заключение

Проект клиентского приложения Telegram в виде псевдографики представляет собой интересное решение, которое сможет привлечь пользователей, ищущих альтернативные способы общения. Успешная реализация проекта зависит от тщательного подхода к разработке, тестированию и документированию, что в конечном итоге приведёт к созданию качественного и безопасного продукта.
